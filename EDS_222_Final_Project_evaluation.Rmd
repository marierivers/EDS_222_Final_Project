---
title: "EDS 222 Final Project"
author: "Marie Rivers"
date: "11/13/2021"
output: 
  html_document:
    theme: flatly
    code_folding: show
    toc: TRUE
    toc_float: TRUE
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(here)
library(skimr)
library(GGally)
library(lubridate)
library(janitor)
library(kableExtra)
library(stringr)
library(ggplot2)
library(patchwork)
library(gghighlight)
library(paletteer)
library(ggExtra)
library(ggrepel)
library(ggbeeswarm)
library(sf)
library(urbnmapr)
library(tidycensus)
#library(tigris)
```

# Read in EQI data and select columns of interest
```{r}
api_txt <- "~/Documents/UCSB_Environmental_Data_Science/EDS_222_Statistics_for_Environmental_Data_Science/Final_Project_Notes/census_key.txt"

api_key <- readLines(api_txt)
census_api_key(api_key)
```
```{r}
vt <- get_acs(geography = "county", 
              variables = c(medincome = "B19013_001"), 
              state = "VT", 
              year = 2018)
vt
```


```{r}
fips_codes <- data.frame(fips_codes)
```

```{r}
eqi <- read_csv(here("data", "eqi_data", "Eqi_results_2013JULY22.csv")) %>% 
  select(stfips, county_name, state, air_EQI_22July2013, water_EQI_22July2013, land_EQI_22July2013, sociod_EQI_22July2013, built_EQI_22July2013, EQI_22July2013) %>% 
  mutate(state_code = substr(stfips, 1, 2)) %>% 
  mutate(county_code = substr(stfips, 3, 5)) %>% 
  relocate(state_code, .after = stfips) %>% 
  relocate(county_code, .after = state_code) %>% 
  left_join(fips_codes, by = c("state_code", "county_code")) %>% 
  mutate(county_name = county) %>% 
  mutate(state = state.x) %>% 
  select(stfips, state_code, county_code, county_name, state, state_name, air_EQI_22July2013, water_EQI_22July2013, land_EQI_22July2013, sociod_EQI_22July2013, built_EQI_22July2013, EQI_22July2013)
```

# Read in county level population data

```{r}
header <- c("county_name", "april_1_2000", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "april_1_2010", "july_1_2010")

codes <- c("01", "02", "04", "05", "06", "08", "09", "10", "11", "12", "13", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "44", "45", "46", "47", "48", "49", "50", "51", "53", "54", "55", "56")
```

```{r, message=FALSE}
source(here("src", "state_pop_fun.R"))
county_pop = data.frame()

for (i in seq_along(codes)) {
state <- state_pop_fun(fips = codes[i])
state_df <- data.frame(state)
county_pop <- rbind(county_pop, state_df)
}
```

```{r}
# join eqi and population data
eqi_pop <- left_join(county_pop, eqi, by = c("county_name", "state_code")) %>% 
  relocate(c(stfips, state_code, county_code, state, state_name), .before = county_name)
```
# Summary Statistics and Graphs

# Statistical Evaluation
## Diffeent means test
**null_hypothesis:** There is no difference in mean EQI for counties with positive and negative population growth.
$$H_{0}: \mu_{NorthCentral} - \mu_{South} = 0$$
**alternative hypothesis:** There is a difference in EQI for counties with positive and negative population growth.
$$H_{A}: \mu_{NorthCentral} - \mu_{South} \neq 0$$

The standard error for a difference in means is defined as: $SE = \sqrt{\frac{s_1^2}{n_1} + \frac{s^2_2}{n_2}}$ and the test-statistic for a hypothesis test is $z = \frac{\text{point estimate - null}}{SE}$

# Linear Model
Build a model for EQI vs population change and a model with coefficients for each EQI category to identify the category most correlated with population change

# Map
```{r}
county_shp <- st_read("data/gz_2010_us_050_00_20m/gz_2010_us_050_00_20m.shp")
```
project
filter only 50 states + DC
try to find a shapefile that makes alaska and hawaii look good

```{r}
# https://urbaninstitute.github.io/urbnmapr/
counties_sf <- get_urbn_map("counties", sf = TRUE)

counties_sf %>% 
  ggplot(aes()) +
  geom_sf(fill = "grey", color = "#ffffff")
```
```{r}

```


```{r}
county_laea %>% 
  ggplot(aes()) +
  geom_sf(fill = "grey", color = "#ffffff")
```



